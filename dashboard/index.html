<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UCPM Test (Authenticated)</title> 
    <script> 
        var OneTrust = {
            dataSubjectParams: {
                id: "data_subject_test", // this would have to be pulled from the Identity provider
                identifierType: "demoIdentifier",
                isAnonymous: false,
                token : "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkYXRhX3N1YmplY3RfdGVzdCJ9.QFr2RoCU-aq1iMrG1gRm8wBeBxKn5hSHBJ5_sXa-YNI" // this would have to be generated server side using a cloud function
            }
        };
    </script>

    <!-- OneTrust Cookies Consent Notice start for camcarpenter34.github.io/cdc-demo/dashboard/ -->
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="019a603f-596e-77e6-a6bb-8e1a08784bd5" ></script>
    <script type="text/javascript">
    function OptanonWrapper() { 

            console.log("OneTrust SDK Initialized.");
            OneTrust.InsertScript('/scripts/perf_cookie.js', 'head', null, null, 'C0002')
            showConsentState(); // Display anonymous UUID and categories
        }
    </script>

<!-- OneTrust Cookies Consent Notice end for  camcarpenter34.github.io/cdc-demo/dashboard/ -->

</head>

<body>

    <h1> Welcome Back</h1>
    <p>Your Cookie ID is now linked to your Data Subject Profile.</p>

    <button onclick="showConsentState()">Show Current Consent State</button>
    <pre id="output"></pre>

    <a href="sdk-preferences/">Custom Preference Center (SDK)</a>

    <!-- <a href="api-preferences/">Custom Preference Center (API)</a> -->
    
    <script>

        function showConsentState() {
            const domainData = OneTrust.GetDomainData();
            const cookie_id = domainData?.ConsentIntegrationData?.consentPayload?.identifier || "Not available";
            const id_type = domainData?.ConsentIntegrationData?.consentPayload?.identifierType || "Not available";
            console.log("Consent State:", domainData);
        }
    </script>

<!-- Test performance cookie -->
    <script type="text/plain" class="optanon-category-C0002"> 
        document.cookie = "Perf_TestCookie" + "=" + "Test_CookieHere!"; 
    </script>

    <script> 
        window.addEventListener("OneTrustGroupsUpdated",event =>{
        console.log(`The following groups are now active: ${event.detail.join(", ")}`)
        });
    </script>
</body>
</html>


